
name: Test

on: [push]

jobs:
  test_gentoo_build:
    runs-on: ubuntu-latest
    name: Build for Raspberry PI ${{ matrix.pi }} aarch64
    
    strategy:
      matrix:
        include:
          - pi: 3
          - pi: 4

    steps:
      - uses: actions/checkout@v3

      - name: Build for Raspberry PI 3
        uses: expeditioneer/run-on-arch-action@master
        with:
          arch: aarch64
          distro: gentoo_latest
          setup: |
            docker volume create portage
            docker run -d -it --name=portage -v portage:/var/db/repos/gentoo gentoo/portage
          dockerRunArgs: |
            --volume "${PWD}/PI${{ matrix.pi }}:/etc/portage"
            --volume "portage:/var/db/repos/gentoo"
          run: |
            eselect profile set default/linux/arm64/17.0/systemd
            emerge -v sys-kernel/raspberrypi-sources
